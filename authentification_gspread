import gspread
from oauth2client.service_account import ServiceAccountCredentials
import psycopg2

# Use creds to create a client to interact with the Google Drive API

scope = ['https://spreadsheets.google.com/feeds','https://www.googleapis.com/auth/drive']
creds = ServiceAccountCredentials.from_json_keyfile_name('/Users/taliarosenkranz/Documents/Developers_Institute/DI_bootcamp_github/Hackathon/iron_volunteering/google_api_key.json', scope)
client = gspread.authorize(creds)
sheet = client.open("Volunteers (Responses)").sheet1
data = sheet.get_all_records()  

# Extract and print all of the values
#print(data)

# ElephantSQL (PostgreSQL) setup
dbname = 'Iron_volunteering'
user = 'dpcrpkft '
password = 'oWD6EIHE9BHR7GzSktVfCw7FXZ1CX6Lr'
host = 'castor.db.elephantsql.com'
conn = psycopg2.connect(dbname=dbname, user=user, password=password, host=host)
cur = conn.cursor()

# Assuming your table schema and form align perfectly
# Adapt the INSERT statement according to your table's schema
insert_query = 'INSERT INTO volunteers (name, last name, email, phone, id) VALUES (%s, %s, %s, %s, %s)'

for item in data:
    # You need to extract the values from each item (which is a dictionary) in the order of your table columns
    values = (item['name'], item['last name'], item['email'], item['phone'], item['id'] ) 
    cur.execute(insert_query, values)

conn.commit()  # Commit the transaction
cur.close()
conn.close()
